---
title: "Explore **treeheatr**"
author: "Trang Le"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Explore treeheatr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

**treeheatr** displays a more interpretable decision tree visualization by integrating a heatmap at its terminal nodes.
Let's explore the package **treeheatr** a little deeper and see what it can do!


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(treeheatr)
library(dplyr)
```


```{r}
# library(tidyverse)
# library(dplyr)
# library(ggparty)
# library(gtable)
# devtools::install_github("makeyourownmaker/pmlblite")
library(pmlblite) # fetch PMLB datasets
```

What datasets are included in PMLB for classification?
Pick dataset:
```{r}
# PMLB datasets

# dataset_name <- 'mushroom'
# label_map <- c(`0` = 'E', `1` = 'P') # edible or poisonous
# fig_height <- 7
# fig_width <- 10

# dataset_name <- 'breast-cancer-wisconsin'
# label_map <- c(`1` = 'Malignant', `0` = 'Benign')

# dataset_name <- 'yeast'

# dataset_name <- 'breast-cancer'
#
# dataset_name <- 'wine-quality-red'
# my_layout <- data.frame(id = c(2, 29),
#                         x = c(0.1, 0.9),
#                         y = c(0.9, 0.9))

# dataset_name <- 'titanic'
# label_map <- c(`-1` = 'Deceased', `1` = 'Survived') 



# dataset_name <- 'tic-tac-toe'
# label_map <- c(`1` = 'Win', `0` = 'Loss/Draw')

# dataset_name <- 'waveform-40'
# fig_height <- 10
# fig_width <- 10
# 
# classification_dataset_names

```

Let's start with the iris dataset!
Running the `heat_tree()` function can be as simple as:

```{r fig.height=3, fig.width=5}
# dataset_name <- 'iris'
dat_raw <- iris
heat_tree(dat_raw, class_lab = 'Species') %>% 
  grid.draw()
```

But we can also customize our heattree by passing parameters through to different **ggparty** geoms.
For example:

```{r fig.height=3.5, fig.width=6}
heat_tree(
  dat_raw, class_lab = 'Species',
  tree_space_top = 0.1,
  tree_space_bottom = 0.05,
  par_node_vars = list(
    label.size = 0.2,
    label.padding = unit(0.1, "lines"),
    line_list = list(
      aes(label = paste("Node", id)),
      aes(label = splitvar),
      aes(label = paste("p =", formatC(p.value, format = "e", digits = 2)))),
    line_gpar = list(
      list(size = 8),
      list(size = 8),
      list(size = 6)),
    id = 'inner'),
  terminal_vars = list(size = 0),
  edge_vars = list(size = 1, color = 'grey')) %>% 
  grid.draw()
```

## Some more examples

```{r  fig.height=4, fig.width=7}
data(wine, package = 'rattle')

heat_tree(wine, class_lab = 'Type') %>% 
  grid.draw()
```

```{r}
pmlblite::fetch_data('diabetes') %>% 
  heat_tree(class_lab = 'target',
            label_map = c(`1` = 'Negative', `2` = 'Positive')) %>% 
  grid.draw()
```

### An extreme example
This visualization may not be very interpretable but serves the purpose of showing the node layout when the tree grows in size.

```{r fig.height=7, fig.width=7}
pmlblite::fetch_data('wine-quality-red') %>% 
  heat_tree(class_lab = 'target') %>% 
  grid.draw()
```


```{r fig.height=3.5, fig.width=6}
# dataset_name <- 'titanic'
# colnames(dat_raw)
# dat_raw <- read.csv('titanic/train.csv') %>%
#   select(Survived, Pclass, Sex, Age, SibSp, Parch, Fare, Embarked)
# 
# my_fig <- heat_tree(
#   dat_raw,
#   class_lab = 'Survived',
#   label_map = c(`1` = 'Survived', `0` = 'Deceased'),
#   feat_types = c(Pclass = 'factor',
#                  Sex = 'factor',
#                  Age = 'numeric',
#                  SibSp = 'numeric',
#                  Parch = 'numeric',
#                  Fare = 'numeric',
#                  Embarked = 'factor'))
# 
# # grid::grid.newpage()
# grid::grid.draw(my_fig)
```

